puts "============"
puts "0027567: Visualization - possible memory leaks due to use of plain pointers in IVTK"
puts "============"
puts ""

psphere s 10 15 80
box b1 5 5 -5
box b2 -5 -5 -5
ptorus t 10 3
compound s b1 b2 t cc
unset s
unset b1
unset b2
unset t
incmesh cc 1

ivtkinit
ivtktimerlog 0
dlog off

proc doCycle { theI } {
  # display shaded/wireframe
  ivtkdisplay cc
  ivtksetdispmode 1
  ivtksetdispmode 0

  # select/unselect
  ivtkselect 200 200
  ivtkselect 0 0

  # highlight/unhighlight
  ivtkmoveto 200 200
  ivtkmoveto 50 50

  # hide and remove
  ivtkerase  cc
  ivtkremove cc
}

# Create i_max number of shapes
set i_max 15
set listmem {}
for {set i 1} {${i} <= ${i_max}} {incr i} {
  doCycle $i
  lappend listmem [meminfo h]
  checktrend $listmem 0 1 "Memory leak detected"
}
