puts "============"
puts "0027567: Visualization - possible memory leaks due to use of plain pointers in IVTK"
puts "============"
puts ""

psphere s 10 15 80
box b1 5 5 -5
box b2 -5 -5 -5
ptorus t 10 3
compound s b1 b2 t cc
unset s
unset b1
unset b2
unset t
incmesh cc 1

ivtkinit
ivtktimerlog 0

proc doCycle { theI } {
  # display shaded/wireframe
  uplevel #0 ivtkdisplay cc
  uplevel #0 ivtksetdispmode 1
  uplevel #0 ivtksetdispmode 0

  # select/unselect
  uplevel #0 ivtkselect 200 200
  uplevel #0 ivtkselect 0 0

  # highlight/unhighlight
  uplevel #0 ivtkmoveto 200 200
  uplevel #0 ivtkmoveto 50 50

  # hide and remove
  uplevel #0 ivtkerase  cc
  uplevel #0 ivtkremove cc
}

# Create i_max number of shapes
set i_max 15
set listmem {}
for {set i 1} {${i} <= ${i_max}} {incr i} {
  doCycle $i
  lappend listmem [meminfo h]
  checktrend $listmem 0 1 "Memory leak detected"
}
