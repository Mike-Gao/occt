puts "========"
puts "0030396: Infinite recursion during ShapeFix after BRepAlgoAPI_Cut"
puts "========"
puts ""

# With this order of tools the operation produced bad result
set list(1) {a_2 a_3 a_4 a_5 a_6 a_7}
# With this order of tools the operation produced good result
set list(2) {a_6 a_2 a_7 a_3 a_4 a_5}

bfuzzyvalue 1e-2
bnondestructive 1

for {set i 1} { $i <= 2} {incr i} {

  restore [locate_data_file bug30396.brep] a
  explode a

  bclearobjects
  bcleartools
  baddobjects a_1
  eval baddtools $list($i)
  bfillds
  bbop r_$i 2

  checknbshapes r_$i -solid 1 -shell 1
  checkshape r_$i
  if {![regexp "OK" [bopcheck r_$i]]} {
    puts "Error: result $i is self-interfered shape"
  }
}

checkprops r_1 -equal r_2
checkview -display r_2 -2d -path ${imagedir}/${test_image}.png
