puts "============"
puts "OCC28091"
puts "============"
puts ""
######################################################
# Crash in Boolean operation in OCCT 6.7.0 version
######################################################

plane pl11 -791.20078880442713000000 65.00000000000000000000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl11 pl11 5.97022933874066020000 818.49229142655633000000

plane pl12 30.00000000000000000000 65.00000000000000000000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl12 pl12 5.97022933874066020000 818.49229142655633000000

plane pl21 22.00000000000000000000 65.00000000000009900000 856.49229142655633000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.99983060107758093000 0.01840568251500763000 0.00000000000000000000
pcylinder cyl21 pl21 7.97022933874066020000 818.49229142655633000000

plane pl22 22.00000000000000000000 65.00000000000009900000 12.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.99983060107758093000 0.01840568251500763000 0.00000000000000000000
pcylinder cyl22 pl22 7.97022933874066020000 818.49229142655633000000

plane pl31 -791.20078880442713000000 490.00000000000000000000 19.00000000000000700000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl31 pl31 5.97022933874110160000 818.49229142655633000000

plane pl32 29.99999999999999600000 490.00000000000000000000 19.00000000000000700000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl32 pl32 5.97022933874110160000 818.49229142655633000000

plane pl41 22.00000000000000400000 489.99999999999983000000 856.49229142655633000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.99983060107758037000 0.01840568251503782400 0.00000000000000000000
pcylinder cyl41 pl41 7.97022933874111940000 818.49229142655633000000

plane pl42 22.00000000000000400000 489.99999999999983000000 12.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.99983060107758037000 0.01840568251503782400 0.00000000000000000000
pcylinder cyl42 pl42 7.97022933874111940000 818.49229142655633000000

plane pl51 -818.49229142655633000000 39.99999999999999300000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 0.00000000000000142109 1.00000000000000000000
pcylinder cyl51 pl51 4.99999899999999990000 818.49229142655633000000

plane pl52 20.00000000000000000000 39.99999999999999300000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 0.00000000000000142109 1.00000000000000000000
pcylinder cyl52 pl52 4.99999899999999990000 818.49229142655633000000

plane pl61 -818.49229142655633000000 515.00000000000000000000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl61 pl61 4.99999899999999990000 818.49229142655633000000

plane pl62 20.00000000000000000000 515.00000000000000000000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl62 pl62 4.99999899999999990000 818.49229142655633000000

plane pl71 -818.49229142655633000000 277.50000000000000000000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl71 pl71 4.99999899999999990000 818.49229142655633000000

plane pl72 20.00000000000000000000 277.50000000000000000000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl72 pl72 4.99999899999999990000 818.49229142655633000000

plane pl81 -818.49229142655633000000 490.00000000000023000000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 0.00171446966710201870 0.99999853029580033000
pcylinder cyl81 pl81 5.98315484232304940000 818.49229142655633000000

plane pl82 16.70849737787079900000 490.00000000000023000000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 0.00171446966710201870 0.99999853029580033000
pcylinder cyl82 pl82 5.98315484232304940000 818.49229142655633000000

plane pl91 -818.49229142655633000000 65.00000000000029800000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 0.00171446966709728080 0.99999853029580033000
pcylinder cyl91 pl91 5.98315484232236020000 818.49229142655633000000

plane pl92 16.70849737787079900000 65.00000000000029800000 19.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 0.00171446966709728080 0.99999853029580033000
pcylinder cyl92 pl92 5.98315484232236020000 818.49229142655633000000

plane pl101 1418.49229142655620000000 490.00000000000034000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00648490735136420060 -0.99997897276724990000
pcylinder cyl101 pl101 5.98315484232250760000 818.49229142655633000000

plane pl102 583.29150262212897000000 490.00000000000034000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00648490735136420060 -0.99997897276724990000
pcylinder cyl102 pl102 5.98315484232250760000 818.49229142655633000000

plane pl111 577.99999999999989000000 490.00000000000807000000 856.49229142655633000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.99983060107759858000 0.01840568251405005600 0.00000000000000000000
pcylinder cyl111 pl111 7.97022933874109980000 818.49229142655633000000

plane pl112 577.99999999999989000000 490.00000000000807000000 12.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.99983060107759858000 0.01840568251405005600 0.00000000000000000000
pcylinder cyl112 pl112 7.97022933874109980000 818.49229142655633000000

plane pl121 1391.20078880442720000000 490.00000000000000000000 18.99999999999999300000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl121 pl121 5.97022933874110430000 818.49229142655633000000

plane pl122 570.00000000000000000000 490.00000000000000000000 18.99999999999999300000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl122 pl122 5.97022933874110430000 818.49229142655633000000

plane pl131 1418.49229142655620000000 65.00000000000118000000 19.00000000000000400000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00648490735120551590 -0.99997897276725090000
pcylinder cyl131 pl131 5.98315484232232460000 818.49229142655633000000

plane pl132 583.29150262212897000000 65.00000000000118000000 19.00000000000000400000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00648490735120551590 -0.99997897276725090000
pcylinder cyl132 pl132 5.98315484232232460000 818.49229142655633000000

plane pl141 578.00000000000011000000 64.99999999999796800000 856.49229142655633000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.99983060107757549000 0.01840568251530781300 0.00000000000000000000
pcylinder cyl141 pl141 7.97022933874065750000 818.49229142655633000000

plane pl142 578.00000000000011000000 64.99999999999796800000 12.00000000000000200000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.99983060107757549000 0.01840568251530781300 0.00000000000000000000
pcylinder cyl142 pl142 7.97022933874065750000 818.49229142655633000000

plane pl151 1391.20078880442720000000 65.00000000000000000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl151 pl151 5.97022933874066460000 818.49229142655633000000

plane pl152 570.00000000000000000000 65.00000000000000000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 1.00000000000000000000
pcylinder cyl152 pl152 5.97022933874066460000 818.49229142655633000000

plane pl161 1418.49229142655620000000 277.50000000000000000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000
pcylinder cyl161 pl161 4.99999899999999990000 818.49229142655633000000

plane pl162 580.00000000000000000000 277.50000000000000000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000
pcylinder cyl162 pl162 4.99999899999999990000 818.49229142655633000000

plane pl171 1418.49229142655620000000 40.00000000000000000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000
pcylinder cyl171 pl171 4.99999899999999720000 818.49229142655633000000

plane pl172 580.00000000000000000000 40.00000000000000000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000
pcylinder cyl172 pl172 4.99999899999999720000 818.49229142655633000000

plane pl181 1418.49229142655620000000 515.00000000000000000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000
pcylinder cyl181 pl181 4.99999899999999990000 818.49229142655633000000

plane pl182 580.00000000000000000000 515.00000000000000000000 19.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000
pcylinder cyl182 pl182 4.99999899999999990000 818.49229142655633000000


binrestore [locate_data_file bug28091_Platte_mit_Minifix.brep] sh

compound CmpdSrcFList

foreach ff [ explode sh f ] {
  settolerance $ff 1.0e-7
  fixshape rf $ff
  add rf CmpdSrcFList
}

puts ""
puts ""

set i 0
foreach x {1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18} {
  incr i
  
  copy CmpdSrcFList sshape
  foreach cyf [explode cyl${x}1 f] {
    mksurface sf $cyf;
    if { [ string first "Cylindr" [ dump sf ] ]  >= 0 } {
      bsection r${i}1 sshape $cyf -n2d -na
      break
    }
  }
  
  copy CmpdSrcFList sshape
  foreach cyf [explode cyl${x}2 f] {
    mksurface sf $cyf;
    if { [ string first "Cylindr" [ dump sf ] ]  >= 0 } {
      bsection r${i}2 sshape $cyf -n2d -na
      break
    }
  }
}

# The true number of entities is not important.
# The main idea is to check if:
#   1. The result (r*) is empty or not.
#   2. new interfered entities are found or
#       if some interferences are not detected but was
#       detected earlier.
#
# Changes in behavior at least in one item must be considered (most likely)
# as regression.

checknbshapes r11 -vertex 0
checknbshapes r12 -vertex 3
checknbshapes r21 -vertex 0
checknbshapes r22 -vertex 3
checknbshapes r31 -vertex 0
checknbshapes r32 -vertex 3
checknbshapes r41 -vertex 0
checknbshapes r42 -vertex 3
checknbshapes r51 -vertex 0
checknbshapes r52 -vertex 3
checknbshapes r61 -vertex 1
checknbshapes r62 -vertex 3
checknbshapes r71 -vertex 0
checknbshapes r72 -vertex 3
checknbshapes r81 -vertex 0
checknbshapes r82 -vertex 4
checknbshapes r91 -vertex 0
checknbshapes r92 -vertex 4
checknbshapes r101 -vertex 0
checknbshapes r102 -vertex 4
checknbshapes r111 -vertex 0
checknbshapes r112 -vertex 3
checknbshapes r121 -vertex 0
checknbshapes r122 -vertex 3
checknbshapes r131 -vertex 0
checknbshapes r132 -vertex 4
checknbshapes r141 -vertex 0
checknbshapes r142 -vertex 3
checknbshapes r151 -vertex 0
checknbshapes r152 -vertex 3
checknbshapes r161 -vertex 1
checknbshapes r162 -vertex 3
checknbshapes r171 -vertex 1
checknbshapes r172 -vertex 3
checknbshapes r181 -vertex 1
checknbshapes r182 -vertex 5
