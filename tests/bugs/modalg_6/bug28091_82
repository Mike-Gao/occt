puts "============"
puts "OCC28091"
puts "============"
puts ""
######################################################
# Crash in Boolean operation in OCCT 6.7.0 version
######################################################

plane pl21 17.49915534244081500000 -713.98893370960923000000 21.50000000000000000000 0.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000373970
pcylinder cyl21 pl21 4.74990000000000020000 716.73893370960923000000

plane pl22 17.49915534244081500000 20.00000000000000000000 21.50000000000000000000 0.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000373970
pcylinder cyl22 pl22 4.74990000000000020000 716.73893370960923000000

plane pl31 17.49915534244081500000 -716.73893370960923000000 21.50000000000000000000 0.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000355271
pcylinder cyl31 pl31 6.99990000000000020000 716.73893370960923000000

plane pl32 17.49915534244081500000 0.50000000000000000000 21.50000000000000000000 0.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000355271
pcylinder cyl32 pl32 6.99990000000000020000 716.73893370960923000000

plane pl41 864.60671560868866000000 350.82512621490918000000 21.50000000000001800000 -0.95153384789598372000 0.30754403962402360000 0.00000000000000000000 -0.00000000000000022402 -0.00000000000000069311 1.00000000000000000000
pcylinder cyl41 pl41 11.99989999999998200000 716.73893370960923000000

plane pl42 181.17805930727573000000 571.71522930321373000000 21.50000000000001800000 -0.95153384789598372000 0.30754403962402360000 0.00000000000000000000 -0.00000000000000022402 -0.00000000000000069311 1.00000000000000000000
pcylinder cyl42 pl42 11.99989999999998200000 716.73893370960923000000

plane pl51 886.13479838233548000000 417.43249556759054000000 21.50000000000001400000 -0.95153384789596396000 0.30754403962408455000 0.00000000000000000000 -0.00000000000000022402 -0.00000000000000069311 1.00000000000000000000
pcylinder cyl51 pl51 11.99989999999998800000 716.73893370960923000000

plane pl52 202.70614208093704000000 638.32259865593880000000 21.50000000000001400000 -0.95153384789596396000 0.30754403962408455000 0.00000000000000000000 -0.00000000000000022402 -0.00000000000000069311 1.00000000000000000000
pcylinder cyl52 pl52 11.99989999999998800000 716.73893370960923000000

plane pl61 884.70749761050865000000 417.89381162707906000000 21.50000000000001400000 -0.95153384789598749000 0.30754403962401156000 0.00000000000000000000 -0.00000000000003662943 -0.00000000000011333057 1.00000000000000000000
pcylinder cyl61 pl61 3.99990000000000690000 716.73893370960923000000

plane pl62 189.43814606495815000000 642.61093070160621000000 21.50000000000001400000 -0.95153384789598749000 0.30754403962401156000 0.00000000000000000000 -0.00000000000003662943 -0.00000000000011333057 1.00000000000000000000
pcylinder cyl62 pl62 3.99990000000000690000 716.73893370960923000000

plane pl71 -494.80324092508818000000 863.76371543765504000000 21.50000000000000000000 0.95153384789600659000 -0.30754403962395255000 0.00000000000000000000 -0.30754403962395255000 -0.95153384789600659000 -0.00000000000000355271
pcylinder cyl71 pl71 5.99985000000015490000 716.73893370960923000000

plane pl72 187.54700997912067000000 643.22216238043495000000 21.50000000000000000000 0.95153384789600659000 -0.30754403962395255000 0.00000000000000000000 -0.30754403962395255000 -0.95153384789600659000 -0.00000000000000355271
pcylinder cyl72 pl72 5.99985000000015490000 716.73893370960923000000

plane pl91 863.17941483684649000000 351.28644227435132000000 21.50000000000001800000 -0.95153384789598627000 0.30754403962401555000 0.00000000000000000000 -0.00000000000003662943 -0.00000000000011333057 1.00000000000000000000
pcylinder cyl91 pl91 3.99990000000000330000 716.73893370960923000000

plane pl92 169.80608419378189000000 575.39075085469756000000 21.50000000000001800000 -0.95153384789598627000 0.30754403962401555000 0.00000000000000000000 -0.00000000000003662943 -0.00000000000011333057 1.00000000000000000000
pcylinder cyl92 pl92 3.99990000000000330000 716.73893370960923000000

plane pl101 -514.43530279621132000000 796.54353559091192000000 21.50000000000000000000 0.95153384789593232000 -0.30754403962418225000 0.00000000000000000000 -0.30754403962418225000 -0.95153384789593243000 -0.00000000000000355271
pcylinder cyl101 pl101 5.99984999999976500000 716.73893370960923000000

plane pl102 167.91494810794507000000 576.00198253352676000000 21.50000000000000000000 0.95153384789593232000 -0.30754403962418225000 0.00000000000000000000 -0.30754403962418225000 -0.95153384789593243000 -0.00000000000000355271
pcylinder cyl102 pl102 5.99984999999976500000 716.73893370960923000000

binrestore [locate_data_file bug28091_PL004_LegTimber.brep] sh

compound CmpdSrcFList

foreach ff [ explode sh f ] {
  settolerance $ff 1.0e-7
  fixshape rf $ff
  add rf CmpdSrcFList
}

puts ""
puts ""

set i 0
foreach x {2 3 4 5 6 7 9 10} {
  incr i
  
  copy CmpdSrcFList sshape
  foreach cyf [explode cyl${x}1 f] {
    mksurface sf $cyf;
    if { [ string first "Cylindr" [ dump sf ] ]  >= 0 } {
      bsection r${i}1 sshape $cyf -n2d -na
      break
    }
  }
  
  copy CmpdSrcFList sshape
  foreach cyf [explode cyl${x}2 f] {
    mksurface sf $cyf;
    if { [ string first "Cylindr" [ dump sf ] ]  >= 0 } {
      bsection r${i}2 sshape $cyf -n2d -na
      break
    }
  }
}

# The true number of entities is not important.
# The main idea is to check if:
#   1. The result (r*) is empty or not.
#   2. new interfered entities are found or
#       if some interferences are not detected but was
#       detected earlier.
#
# Changes in behavior at least in one item must be considered (most likely)
# as regression.

checknbshapes r11 -vertex 0
checknbshapes r12 -vertex 2
checknbshapes r21 -vertex 0
checknbshapes r22 -vertex 3
checknbshapes r31 -vertex 0
checknbshapes r32 -vertex 2
checknbshapes r41 -vertex 0
checknbshapes r42 -vertex 2
checknbshapes r51 -vertex 0
checknbshapes r52 -vertex 0
checknbshapes r61 -vertex 0
checknbshapes r62 -vertex 1
checknbshapes r71 -vertex 0
checknbshapes r72 -vertex 0
checknbshapes r81 -vertex 0
checknbshapes r82 -vertex 1
