puts "============"
puts "OCC28091"
puts "============"
puts ""
######################################################
# Crash in Boolean operation in OCCT 6.7.0 version
######################################################

plane pl11 178.77237918818810000000 699.97907525088567000000 394.06353633294685000000 0.00000000000000000000 -0.84799830400508847000 -0.52999894000317915000 0.91257304423360708000 -0.21672384368325631000 0.34675814989321085000
pcylinder cyl11 pl11 3.99999849989999890000 502.06388610853338000000

plane pl12 178.77237918818810000000 253.02979372851831000000 114.72023538146782000000 0.00000000000000000000 -0.84799830400508847000 -0.52999894000317915000 0.91257304423360708000 -0.21672384368325631000 0.34675814989321085000
pcylinder cyl12 pl12 3.99999849989999890000 502.06388610853338000000

plane pl21 92.07793998599527200000 720.56784040079503000000 361.12151209309201000000 0.00000000000000000000 -0.84799830400508847000 -0.52999894000317915000 0.91257304423360708000 -0.21672384368325631000 0.34675814989321085000
pcylinder cyl21 pl21 3.99999849989999890000 502.06388610853338000000

plane pl22 92.07793998599527200000 273.61855887842762000000 81.77821114161297100000 0.00000000000000000000 -0.84799830400508847000 -0.52999894000317915000 0.91257304423360708000 -0.21672384368325631000 0.34675814989321085000
pcylinder cyl22 pl22 3.99999849989999890000 502.06388610853338000000

plane pl31 265.46681839038092000000 679.39031010097654000000 427.00556057280176000000 0.00000000000000000000 -0.84799830400508847000 -0.52999894000317915000 0.91257304423360708000 -0.21672384368325631000 0.34675814989321085000
pcylinder cyl31 pl31 3.99999849989999890000 502.06388610853338000000

plane pl32 265.46681839038092000000 232.44102857860909000000 147.66225962132268000000 0.00000000000000000000 -0.84799830400508847000 -0.52999894000317915000 0.91257304423360708000 -0.21672384368325631000 0.34675814989321085000
pcylinder cyl32 pl32 3.99999849989999890000 502.06388610853338000000

plane pl41 -502.06388610853338000000 125.38333636146797000000 21.37167791462789200000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.99916288838046008000 -0.04090870913652000500
pcylinder cyl41 pl41 3.99999849989999890000 502.06388610853338000000

plane pl42 25.00000000000000000000 125.38333636146797000000 21.37167791462789200000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.99916288838046008000 -0.04090870913652000500
pcylinder cyl42 pl42 3.99999849989999890000 502.06388610853338000000

plane pl51 -502.06388610853338000000 220.30381075761164000000 25.25800528259771500000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.99916288838046008000 -0.04090870913652000500
pcylinder cyl51 pl51 3.99999849989999890000 502.06388610853338000000

plane pl52 25.00000000000000000000 220.30381075761164000000 25.25800528259771500000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.99916288838046008000 -0.04090870913652000500
pcylinder cyl52 pl52 3.99999849989999890000 502.06388610853338000000

plane pl61 -502.06388610853338000000 30.46286196532426500000 17.48535054665808300000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.99916288838046008000 -0.04090870913652000500
pcylinder cyl61 pl61 3.99999849989999890000 502.06388610853338000000

plane pl62 25.00000000000000000000 30.46286196532426500000 17.48535054665808300000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 0.00000000000000000000 -0.99916288838046008000 -0.04090870913652000500
pcylinder cyl62 pl62 3.99999849989999890000 502.06388610853338000000

binrestore [locate_data_file bug28091_handlauf_kruemmer.brep] sh

compound CmpdSrcFList

foreach ff [ explode sh f ] {
  settolerance $ff 1.0e-7
  fixshape rf $ff
  add rf CmpdSrcFList
}

puts ""
puts ""

set i 0
foreach x {1 2 3 4 5 6} {
  incr i
  
  copy CmpdSrcFList sshape
  foreach cyf [explode cyl${x}1 f] {
    mksurface sf $cyf;
    if { [ string first "Cylindr" [ dump sf ] ]  >= 0 } {
      bsection r${i}1 sshape $cyf -n2d -na
      break
    }
  }
  
  copy CmpdSrcFList sshape
  foreach cyf [explode cyl${x}2 f] {
    mksurface sf $cyf;
    if { [ string first "Cylindr" [ dump sf ] ]  >= 0 } {
      bsection r${i}2 sshape $cyf -n2d -na
      break
    }
  }
}

# The true number of entities is not important.
# The main idea is to check if:
#   1. The result (r*) is empty or not.
#   2. new interfered entities are found or
#       if some interferences are not detected but was
#       detected earlier.
#
# Changes in behavior at least in one item must be considered (most likely)
# as regression.

checknbshapes r11 -vertex 0
checknbshapes r12 -vertex 3
checknbshapes r21 -vertex 0
checknbshapes r22 -vertex 3
checknbshapes r31 -vertex 0
checknbshapes r32 -vertex 3
checknbshapes r41 -vertex 0
checknbshapes r42 -vertex 3
checknbshapes r51 -vertex 0
checknbshapes r52 -vertex 3
checknbshapes r61 -vertex 0
checknbshapes r62 -vertex 3
