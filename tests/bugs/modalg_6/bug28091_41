puts "============"
puts "OCC28091"
puts "============"
puts ""
######################################################
# Crash in Boolean operation in OCCT 6.7.0 version
######################################################

proc FindFaces { boolres } {
  upvar ${boolres} ${boolres}
  
  global result
  global ListCanEdges
  
  foreach ff [explode $boolres f] {
    set HasSame 0
    foreach ee [explode $ff e] {
      foreach fc $ListCanEdges {
        upvar ${fc} ${fc}
        if { [regexp "shapes are not same" [ compare $ee $fc ] full ] == 0 } {
          set HasSame 1
          break
        }
      }
      
      if { $HasSame != 0 } {
        break;
      }    
    }

    if { $HasSame == 0 } {
      add $ff result
    }  
  }  
}

# The main idea of the test is: obtain set of faces
# (which will be stored in "result" compound).
# Set of faces must be closed in U-direction.

compound result

cylinder cylf1 1206.16230817000000000000 116.04451630099993000000 92.00000000000011400000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan1 cylf1 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf3 1206.16230817000000000000 236.04451630099993000000 92.00000000000009900000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan3 cylf3 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf5 1206.16230817000000000000 356.04451630099993000000 92.00000000000008500000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan5 cylf5 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf7 1206.16230817000000000000 476.04451630099993000000 92.00000000000007100000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan7 cylf7 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf9 127.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan9 cylf9 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf11 248.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan11 cylf11 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf13 369.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan13 cylf13 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf15 490.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan15 cylf15 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf17 801.64327191629991000000 763.46196366859999000000 56.08367445015004900000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 8.00000000000000000000
mkface fcan17 cylf17 0.0 6.28318530717958620000 -10.08367445014999200000 58.91632554985000800000

cylinder cylf20 1206.16230817000000000000 596.04451630099993000000 92.00000000000005700000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan20 cylf20 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf22 1206.16230817000000000000 716.04451630099993000000 92.00000000000004300000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan22 cylf22 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf24 1206.16230817000000000000 836.04451630099993000000 92.00000000000002800000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan24 cylf24 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf26 611.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan26 cylf26 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf28 732.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan28 cylf28 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf30 853.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 10.00000000000000000000
mkface fcan30 cylf30 0.0 6.28318530717958620000 -92.00000000000000000000 184.00000000000000000000

cylinder cylf32 105.53679809799996000000 909.25902500140000000000 62.00000000000003600000 -0.82214404103074601000 -0.56927952343083188000 0.00000000000000006320 -0.56927952343083188000 0.82214404103074601000 -0.00000000000000009128 12.00000000000000000000
mkface fcan32 cylf32 0.0 6.28318530717958620000 -20.87551167546213500000 99.12448832485984000000

cylinder cylf35 475.56848832800006000000 374.86539833100005000000 62.00000000000009200000 -0.82214404103074601000 -0.56927952343083188000 0.00000000000000006320 -0.56927952343083188000 0.82214404103074601000 -0.00000000000000009128 12.00000000000000000000
mkface fcan35 cylf35 0.0 6.28318530717958620000 -20.87551167574295600000 99.12448832499993000000

cylinder cylf41 1206.16230817000000000000 116.04451630099993000000 92.00000000000011400000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan41 cylf41 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf44 1246.16230817000000000000 548.74451630099998000000 92.00000000000007100000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 12.00000000000000000000
mkface fcan44 cylf44 0.0 6.28318530717958620000 -62.00000000000000000000 124.00000000000000000000

cylinder cylf57 105.53679809799996000000 909.25902500140000000000 62.00000000000003600000 -0.82214404103074601000 -0.56927952343083188000 0.00000000000000006320 -0.56927952343083188000 0.82214404103074601000 -0.00000000000000009128 10.50000000000000000000
mkface fcan57 cylf57 0.0 6.28318530717958620000 -40.99301569436870800000 109.18324033408629000000

cylinder cylf59 93.92443418900006700000 901.21824301920014000000 92.00000000000002800000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 5.00000000000000000000
mkface fcan59 cylf59 0.0 6.28318530717958620000 -20.81201028461609300000 41.62402056923218700000

cylinder cylf63 475.56848832800006000000 374.86539833100005000000 62.00000000000009200000 -0.82214404103074601000 -0.56927952343083188000 0.00000000000000006320 -0.56927952343083188000 0.82214404103074601000 -0.00000000000000009128 10.50000000000000000000
mkface fcan63 cylf63 0.0 6.28318530717958620000 -40.99301638716623600000 109.18324068014375000000

cylinder cylf65 463.95612441899993000000 366.82461634900005000000 92.00000000000008500000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 5.00000000000000000000
mkface fcan65 cylf65 0.0 6.28318530717958620000 -20.81201028461609300000 41.62402056923218700000

cylinder cylf81 560.66230816999996000000 1231.44451630100000000000 91.99999999999998600000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 12.00000000000000000000
mkface fcan81 cylf81 0.0 6.28318530717958620000 -70.00000627844994500000 140.00000313922499000000

cylinder cylf88 1206.16230817000000000000 236.04451630099993000000 92.00000000000009900000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan88 cylf88 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf90 1206.16230817000000000000 356.04451630099993000000 92.00000000000008500000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan90 cylf90 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf92 1206.16230817000000000000 476.04451630099993000000 92.00000000000007100000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan92 cylf92 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf94 1206.16230817000000000000 596.04451630099993000000 92.00000000000005700000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan94 cylf94 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf96 1206.16230817000000000000 716.04451630099993000000 92.00000000000004300000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan96 cylf96 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf98 1206.16230817000000000000 836.04451630099993000000 92.00000000000002800000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan98 cylf98 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf100 127.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan100 cylf100 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf102 248.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan102 cylf102 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf104 369.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan104 cylf104 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf106 490.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan106 cylf106 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf108 611.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan108 cylf108 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf110 732.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan110 cylf110 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf112 853.66230816999996000000 1191.44451630100000000000 92.00000000000000000000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 9.00000000000000000000
mkface fcan112 cylf112 0.0 6.28318530717958620000 -184.00000000000000000000 92.00000000000000000000

cylinder cylf199 936.16230816999996000000 385.74451630099998000000 92.00000000000008500000 0.00000000000000000000 -0.00000000000000011102 -1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 0.00000000000000000000 5.00000000000000000000
mkface fcan199 cylf199 0.0 6.28318530717958620000 -86.00000000000000000000 181.00000000000000000000

cylinder cylf267 801.64327191629991000000 763.46196366859999000000 56.08367445015004900000 0.00000000000000000000 0.00000000000000011102 1.00000000000000000000 1.00000000000000000000 0.00000000000000000000 -0.00000000000000000000 7.00000000000000000000
mkface fcan267 cylf267 0.0 6.28318530717958620000 -24.08367445015000600000 65.91632554985001500000

binrestore [locate_data_file bug28091_dsk_tl06_111680.brep] sh
explode sh

nexplode sh_69 e
nexplode sh_70 e
nexplode sh_67 e
nexplode sh_68 e
nexplode sh_35 e
nexplode sh_36 e
nexplode sh_63 e
nexplode sh_64 e
nexplode sh_61 e
nexplode sh_62 e
nexplode sh_32 e
nexplode sh_33 e
nexplode sh_17 e
nexplode sh_18 e
nexplode sh_275 e
nexplode sh_276 e
nexplode sh_48 e
nexplode sh_49 e
nexplode sh_85 e
nexplode sh_86 e
nexplode sh_1 e
nexplode sh_2 e
nexplode sh_39 e
nexplode sh_40 e
nexplode sh_3 e
nexplode sh_4 e
nexplode sh_92 e
nexplode sh_93 e
nexplode sh_5 e
nexplode sh_6 e
nexplode sh_94 e
nexplode sh_95 e
nexplode sh_7 e
nexplode sh_8 e
nexplode sh_96 e
nexplode sh_97 e
nexplode sh_20 e
nexplode sh_21 e
nexplode sh_98 e
nexplode sh_99 e
nexplode sh_22 e
nexplode sh_23 e
nexplode sh_100 e
nexplode sh_101 e
nexplode sh_102 e
nexplode sh_103 e
nexplode sh_24 e
nexplode sh_25 e
nexplode sh_9 e
nexplode sh_10 e
nexplode sh_104 e
nexplode sh_105 e
nexplode sh_11 e
nexplode sh_12 e
nexplode sh_106 e
nexplode sh_107 e
nexplode sh_13 e
nexplode sh_14 e
nexplode sh_108 e
nexplode sh_109 e
nexplode sh_110 e
nexplode sh_111 e
nexplode sh_15 e
nexplode sh_16 e
nexplode sh_26 e
nexplode sh_27 e
nexplode sh_112 e
nexplode sh_113 e
nexplode sh_28 e
nexplode sh_29 e
nexplode sh_114 e
nexplode sh_115 e
nexplode sh_30 e
nexplode sh_31 e
nexplode sh_116 e
nexplode sh_117 e
nexplode sh_216 e
nexplode sh_217 e

compound sh_1_2 sh_1_3 sh_2_2 sh_2_3 cmpde1
compound sh_3_2 sh_3_3 sh_4_2 sh_4_3 cmpde3
compound sh_5_2 sh_5_3 sh_6_2 sh_6_3 cmpde5
compound sh_7_2 sh_7_3 sh_8_2 sh_8_3 cmpde7
compound sh_9_2 sh_9_3 sh_10_2 sh_10_3 cmpde9
compound sh_11_2 sh_11_3 sh_12_2 sh_12_3 cmpde11
compound sh_13_2 sh_13_3 sh_14_2 sh_14_3 cmpde13
compound sh_15_2 sh_15_3 sh_16_2 sh_16_3 cmpde15
compound sh_17_2 sh_17_3 sh_18_2 sh_18_3 cmpde17
compound sh_20_2 sh_20_3 sh_21_2 sh_21_3 cmpde20
compound sh_22_2 sh_22_3 sh_23_2 sh_23_3 cmpde22
compound sh_24_2 sh_24_3 sh_25_2 sh_25_3 cmpde24
compound sh_26_2 sh_26_3 sh_27_2 sh_27_3 cmpde26
compound sh_28_2 sh_28_3 sh_29_2 sh_29_3 cmpde28
compound sh_30_2 sh_30_3 sh_31_2 sh_31_3 cmpde30
compound sh_32_1 sh_32_4 sh_33_1 sh_33_4 cmpde32
compound sh_35_1 sh_35_4 sh_36_1 sh_36_4 cmpde35
compound sh_39_2 sh_39_3 sh_40_2 sh_40_3 cmpde41
compound sh_48_2 sh_48_3 sh_49_2 sh_49_3 cmpde44
compound sh_61_1 sh_61_4 sh_62_10 sh_62_11 sh_62_12 sh_62_1 sh_62_4 sh_62_5 sh_62_6 sh_62_7 sh_62_8 sh_62_9 cmpde57
compound sh_63_2 sh_63_3 sh_64_2 sh_64_3 sh_64_4 sh_64_5 sh_64_6 cmpde59
compound sh_67_1 sh_67_4 sh_68_1 sh_68_11 sh_68_12 sh_68_4 sh_68_5 sh_68_6 cmpde63
compound sh_69_2 sh_69_3 sh_70_2 sh_70_3 sh_70_6 cmpde65
compound sh_85_2 sh_85_3 sh_86_1 sh_86_3 sh_86_4 sh_86_5 cmpde81
compound sh_92_2 sh_92_3 sh_93_2 sh_93_3 cmpde88
compound sh_94_2 sh_94_3 sh_95_2 sh_95_3 cmpde90
compound sh_96_2 sh_96_3 sh_97_2 sh_97_3 cmpde92
compound sh_98_2 sh_98_3 sh_99_2 sh_99_3 cmpde94
compound sh_100_2 sh_100_3 sh_101_2 sh_101_3 cmpde96
compound sh_102_2 sh_102_3 sh_103_2 sh_103_3 cmpde98
compound sh_104_2 sh_104_3 sh_105_2 sh_105_3 cmpde100
compound sh_106_2 sh_106_3 sh_107_2 sh_107_3 cmpde102
compound sh_108_2 sh_108_3 sh_109_2 sh_109_3 cmpde104
compound sh_110_2 sh_110_3 sh_111_2 sh_111_3 cmpde106
compound sh_112_2 sh_112_3 sh_113_2 sh_113_3 cmpde108
compound sh_114_2 sh_114_3 sh_115_2 sh_115_3 cmpde110
compound sh_116_2 sh_116_3 sh_117_2 sh_117_3 cmpde112
compound sh_216_2 sh_216_3 sh_217_2 sh_217_3 cmpde199
compound sh_275_2 sh_275_3 sh_275_4 sh_275_5 sh_275_6 sh_275_7 sh_276_2 sh_276_3 cmpde267

set FacesList {1 3 5 7 9 11 13 15 17 20 22 24 26 28 30 32 35 41 44 59 65 81 88 90 92 94 96 98 100 102 104 106 108 110 112 199 267}
set FacesList1 {57 63}

###################

foreach x $FacesList {
  set ListCanEdges [ explode fcan${x} e ]

  bclearobjects
  bcleartools
  baddobjects fcan${x}
  baddctools cmpde${x}
  bfillds
  bbuild res${x}

  checknbshapes res${x} -wire 3 -face 3
  FindFaces res${x}
}

foreach x $FacesList1 {
  set ListCanEdges [ explode fcan${x} e ]

  bclearobjects
  bcleartools
  baddobjects fcan${x}
  baddctools cmpde${x}
  bfillds
  bbuild res${x}

  checknbshapes res${x} -wire 5 -face 4
  FindFaces res${x}
}


checknbshapes result -face [expr [ llength $FacesList ]+2*[ llength $FacesList1 ]]
checkprops result -s 182603

smallview
donly result
fit
erase axes

checkview -screenshot -2d -path ${imagedir}/${test_image}.png 
