puts "============"
puts "OCC28091"
puts "============"
puts ""
######################################################
# Crash in Boolean operation in OCCT 6.7.0 version
######################################################

plane pl11 360.64999999999998000000 363.50000000000000000000 887.27057539428915000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl11 pl11 1.44783813410292650000 840.56943759128910000000

plane pl12 360.64999999999998000000 363.50000000000000000000 41.80475562129753800000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl12 pl12 1.44783813410292650000 840.56943759128910000000

plane pl21 291.64999999999998000000 363.50000000000000000000 862.95307546828906000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl21 pl21 2.45069470748317690000 840.56943759128910000000

plane pl22 291.64999999999998000000 363.50000000000000000000 10.88409138929027300000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl22 pl22 2.45069470748317690000 840.56943759128910000000

plane pl31 227.64999999999998000000 70.19999999999998900000 851.17908469028907000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl31 pl31 2.45649784765449520000 840.56943759128910000000

plane pl32 227.64999999999998000000 70.19999999999998900000 0.32146775498884139000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl32 pl32 2.45649784765449520000 840.56943759128910000000

plane pl41 243.64999999999998000000 70.19999999999998900000 845.57346987828907000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl41 pl41 1.49767511899012230000 840.56943759128910000000

plane pl42 243.64999999999998000000 70.19999999999998900000 1.65686650884902110000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl42 pl42 1.49767511899012230000 840.56943759128910000000

plane pl51 243.64999999999998000000 363.50000000000000000000 845.57346987828907000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl51 pl51 1.49767511899047220000 840.56943759128910000000

plane pl52 243.64999999999998000000 363.50000000000000000000 1.65686650884902060000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl52 pl52 1.49767511899047220000 840.56943759128910000000

plane pl61 62.64999999999997700000 363.50000000000000000000 887.27057539428915000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl61 pl61 1.44780322481607370000 840.56943759128910000000

plane pl62 62.64999999999997700000 363.50000000000000000000 41.80524595691022000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl62 pl62 1.44780322481607370000 840.56943759128910000000

plane pl71 131.64999999999998000000 363.50000000000000000000 862.95307546828906000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl71 pl71 2.45057953796842610000 840.56943759128910000000

plane pl72 131.64999999999998000000 363.50000000000000000000 10.88499440123908700000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl72 pl72 2.45057953796842610000 840.56943759128910000000

plane pl81 195.64999999999998000000 70.19999999999998900000 851.17908469028907000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl81 pl81 2.45650071765638730000 840.56943759128910000000

plane pl82 195.64999999999998000000 70.19999999999998900000 0.32171292182658462000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl82 pl82 2.45650071765638730000 840.56943759128910000000

plane pl91 179.64999999999998000000 70.19999999999998900000 845.57346987828907000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl91 pl91 1.49767389476371740000 840.56943759128910000000

plane pl92 179.64999999999998000000 70.19999999999998900000 1.65700206202671030000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl92 pl92 1.49767389476371740000 840.56943759128910000000

plane pl101 179.64999999999998000000 363.50000000000000000000 845.57346987828907000000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl101 pl101 1.49767389476351780000 840.56943759128910000000

plane pl102 179.64999999999998000000 363.50000000000000000000 1.65700206202670900000 0.00000000000000000000 0.00000000000000000000 -1.00000000000000000000 -1.00000000000000000000 0.00000000000000000000 0.00000000000000000000
pcylinder cyl102 pl102 1.49767389476351780000 840.56943759128910000000

binrestore [locate_data_file bug28091_facade.brep] sh

compound CmpdSrcFList

foreach ff [ explode sh f ] {
  settolerance $ff 1.0e-7
  fixshape rf $ff
  add rf CmpdSrcFList
}

puts ""
puts ""

set i 0
foreach x {1 2 3 4 5 6 7 8 9 10} {
  incr i
  
  copy CmpdSrcFList sshape
  foreach cyf [explode cyl${x}1 f] {
    mksurface sf $cyf;
    if { [ string first "Cylindr" [ dump sf ] ]  >= 0 } {
      bsection r${i}1 sshape $cyf -n2d -na
      break
    }
  }
  
  copy CmpdSrcFList sshape
  foreach cyf [explode cyl${x}2 f] {
    mksurface sf $cyf;
    if { [ string first "Cylindr" [ dump sf ] ]  >= 0 } {
      bsection r${i}2 sshape $cyf -n2d -na
      break
    }
  }
}

# The true number of entities is not important.
# The main idea is to check if:
#   1. The result (r*) is empty or not.
#   2. new interfered entities are found or
#       if some interferences are not detected but was
#       detected earlier.
#
# Changes in behavior at least in one item must be considered (most likely)
# as regression.

checknbshapes r11 -vertex 3
checknbshapes r12 -vertex 0
checknbshapes r21 -vertex 3
checknbshapes r22 -vertex 0
checknbshapes r31 -vertex 3
checknbshapes r32 -vertex 0
checknbshapes r41 -vertex 3
checknbshapes r42 -vertex 0
checknbshapes r51 -vertex 3
checknbshapes r52 -vertex 0
checknbshapes r61 -vertex 3
checknbshapes r62 -vertex 0
checknbshapes r71 -vertex 3
checknbshapes r72 -vertex 0
checknbshapes r81 -vertex 3
checknbshapes r82 -vertex 0
checknbshapes r91 -vertex 2
checknbshapes r92 -vertex 0
checknbshapes r101 -vertex 3
checknbshapes r102 -vertex 0
